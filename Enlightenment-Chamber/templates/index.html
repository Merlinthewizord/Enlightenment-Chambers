<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Enlightenment Dialogue</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #070916;
        --ink: #f5efe6;
        --muted: #b9b1c8;
        --accent: #f7b05b;
        --accent-2: #7bdff2;
        --panel: rgba(15, 18, 41, 0.82);
        --shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
        --spark: rgba(255, 255, 255, 0.8);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Garamond", "Times New Roman", serif;
        color: var(--ink);
        background: radial-gradient(circle at 15% 20%, #1e1c3b 0%, #0c0d20 40%, var(--bg) 80%);
        position: relative;
        overflow-x: hidden;
      }

      body::before,
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 0;
      }

      body::before {
        background-image:
          radial-gradient(2px 2px at 12% 18%, rgba(255, 255, 255, 0.9) 60%, transparent 61%),
          radial-gradient(1.5px 1.5px at 32% 68%, rgba(255, 227, 148, 0.9) 60%, transparent 61%),
          radial-gradient(1px 1px at 74% 24%, rgba(123, 223, 242, 0.9) 60%, transparent 61%),
          radial-gradient(2px 2px at 86% 72%, rgba(255, 106, 106, 0.85) 60%, transparent 61%),
          radial-gradient(1.5px 1.5px at 58% 46%, rgba(255, 255, 255, 0.7) 60%, transparent 61%),
          radial-gradient(1px 1px at 10% 80%, rgba(123, 223, 242, 0.7) 60%, transparent 61%),
          radial-gradient(1.8px 1.8px at 44% 14%, rgba(255, 227, 148, 0.85) 60%, transparent 61%),
          radial-gradient(1px 1px at 68% 90%, rgba(255, 106, 106, 0.7) 60%, transparent 61%),
          radial-gradient(1.2px 1.2px at 20% 40%, rgba(255, 255, 255, 0.8) 60%, transparent 61%),
          radial-gradient(1.4px 1.4px at 92% 36%, rgba(123, 223, 242, 0.85) 60%, transparent 61%),
          radial-gradient(1.1px 1.1px at 52% 78%, rgba(255, 227, 148, 0.75) 60%, transparent 61%);
        opacity: 0.9;
        animation: twinkle 6s ease-in-out infinite alternate, drift 80s linear infinite;
      }

      body::after {
        background-image:
          radial-gradient(120px 120px at 80% 15%, rgba(123, 223, 242, 0.22), transparent 60%),
          radial-gradient(200px 200px at 10% 70%, rgba(255, 227, 148, 0.18), transparent 65%),
          radial-gradient(160px 160px at 65% 85%, rgba(255, 106, 106, 0.18), transparent 70%),
          radial-gradient(220px 220px at 40% 35%, rgba(255, 255, 255, 0.08), transparent 70%);
        filter: blur(0.5px);
        animation: drift 120s linear infinite reverse;
      }
      }

      header {
        padding: 32px 20px 12px;
        text-align: center;
        position: relative;
        z-index: 1;
      }

      h1 {
        margin: 0;
        font-size: clamp(2rem, 4vw, 3rem);
        letter-spacing: 0.02em;
        text-shadow: 0 0 12px rgba(123, 223, 242, 0.35);
      }

      p {
        margin: 12px auto 0;
        max-width: 720px;
        color: var(--muted);
        font-size: 1rem;
      }

      main {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        z-index: 1;
      }

      .panel {
        background: var(--panel);
        border-radius: 18px;
        padding: 20px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(255, 255, 255, 0.12);
        backdrop-filter: blur(10px);
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
      }

      label {
        font-weight: 600;
      }

      input[type="number"] {
        width: 120px;
        padding: 8px 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        font-size: 1rem;
        background: rgba(10, 12, 28, 0.9);
        color: var(--ink);
      }

      button {
        border: none;
        background: var(--accent);
        color: #25180a;
        padding: 10px 18px;
        border-radius: 12px;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 6px 12px rgba(184, 92, 56, 0.35);
      }

      button:disabled {
        opacity: 0.6;
        cursor: wait;
      }

      button:hover:not(:disabled) {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(184, 92, 56, 0.4);
      }

      .status {
        text-align: center;
        color: var(--muted);
        margin-bottom: 12px;
        min-height: 22px;
      }

      .transcript {
        display: grid;
        gap: 12px;
      }

      .entry {
        padding: 14px 16px;
        border-radius: 16px;
        background: rgba(8, 10, 26, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.12);
      }

      .entry .speaker {
        font-weight: 700;
        color: var(--accent-2);
        margin-bottom: 6px;
      }

      .entry.ai-2 .speaker {
        color: var(--accent);
      }

      .entry .text {
        white-space: pre-wrap;
        line-height: 1.5;
      }

      footer {
        text-align: center;
        color: var(--muted);
        padding: 18px 10px 28px;
        font-size: 0.9rem;
        position: relative;
        z-index: 1;
      }

      @media (max-width: 720px) {
        .controls {
          flex-direction: column;
        }
      }

      @keyframes twinkle {
        0% {
          opacity: 0.6;
          filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.2));
        }
        100% {
          opacity: 1;
          filter: drop-shadow(0 0 10px rgba(123, 223, 242, 0.5));
        }
      }

      @keyframes drift {
        0% {
          transform: translate3d(0, 0, 0);
        }
        50% {
          transform: translate3d(-20px, 18px, 0);
        }
        100% {
          transform: translate3d(0, 0, 0);
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>The Enlightenment Chamber</h1>
      <p>
        Two AI instances investigate what enlightenment is and how to achieve it.
        Launch a session to see their dialogue unfold.
      </p>
    </header>
    <main>
      <section class="panel">
        <div class="controls">
          <label for="numExchanges">Exchanges</label>
          <input id="numExchanges" type="number" min="1" max="20" value="6" />
          <button id="runButton">Run Dialogue</button>
        </div>
        <div class="status" id="status"></div>
        <div class="transcript" id="transcript"></div>
      </section>
    </main>
    <footer>Provide your API keys in a local .env file before running the server.</footer>
    <script>
      const runButton = document.getElementById("runButton");
      const numExchanges = document.getElementById("numExchanges");
      const status = document.getElementById("status");
      const transcript = document.getElementById("transcript");

      function renderTranscript(items) {
        transcript.innerHTML = "";
        items.forEach((entry, index) => {
          const wrapper = document.createElement("div");
          wrapper.className = `entry ${index % 2 === 0 ? "ai-1" : "ai-2"}`;
          const speaker = document.createElement("div");
          speaker.className = "speaker";
          speaker.textContent = entry.speaker;
          const text = document.createElement("div");
          text.className = "text";
          text.textContent = entry.text;
          wrapper.appendChild(speaker);
          wrapper.appendChild(text);
          transcript.appendChild(wrapper);
        });
      }

      runButton.addEventListener("click", async () => {
        runButton.disabled = true;
        status.textContent = "Generating dialogue...";
        transcript.innerHTML = "";
        try {
          const response = await fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ num_exchanges: Number(numExchanges.value || 6) }),
          });
          const data = await response.json();
          if (!response.ok) {
            throw new Error(data.error || "Failed to run dialogue.");
          }
          renderTranscript(data.transcript || []);
          status.textContent = data.filename
            ? `Saved transcript to ${data.filename}`
            : "Dialogue complete.";
        } catch (error) {
          status.textContent = error.message;
        } finally {
          runButton.disabled = false;
        }
      });
    </script>
  </body>
</html>
